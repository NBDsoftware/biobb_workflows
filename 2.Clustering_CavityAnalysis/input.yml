working_dir_path: output                              # Workflow output directory
can_write_console_log: True                           # Output log to console
restart: True                                        # Do not execute steps if output files are already created

step0_make_ndx:                                       #
  tool: make_ndx
  paths:
    input_structure_path:  /home/nbd-pablo/repos/eucanshare_wfs/2.Clustering_CavityAnalysis/input/structure.gro # file:/home/nbd-pablo/Documents/2022_EUCANSHARE/MAPK11/WT/repeat1/output/step4_editconf/editconf.gro # Path to input topology (tpr, gro, g96, pdb or brk format) 
    output_ndx_path: index.ndx
  properties:
    selection: "2 & ri 7-106 & ! ri 14-58"        # Atom selection string

step1_gmx_cluster:
  tool: gmx_cluster
  paths:
    input_structure_path:  dependency/step0_make_ndx/input_structure_path  # file:/home/nbd-pablo/Documents/2022_EUCANSHARE/MAPK11/WT/repeat1/output/step4_editconf/editconf.gro  # Path to input topology (tpr, gro, g96, pdb or brk format) 
    input_traj_path:    /home/nbd-pablo/repos/eucanshare_wfs/2.Clustering_CavityAnalysis/input/trajectory.trr     # file:/home/nbd-pablo/Documents/2022_EUCANSHARE/MAPK11/WT/trajs/imaged_traj_all.trr # Path to trajectory (xtc, trr, cpt, gro, g96, pdb or tng format)
    output_pdb_path: output.cluster.pdb
  properties:
    fit_selection: Backbone
    output_selection: System
    dista: False
    method: linkage
    cutoff: 0.1                            # nm (RMSD cut-off)

step2_extract_models:
  tool: extract_model
  paths:
    input_structure_path: dependency/step1_gmx_cluster/output_pdb_path
    output_structure_path: output.pdb      # Dummy, names will be: model0.pdb, model1.pdb ...
  properties:
    models_to_extract: 3                   # Number of most populated models to extract at most (will be < 'number of clusters')

step3_cavity_analysis:
  tool: fpocket_run
  paths:
    input_pdb_path: dependency/step2_extract_models/output_structure_path
    output_pockets_zip: all_pockets.zip
    output_summary: summary.json
  properties:
    min_radius: 3
    max_radius: 6
    num_spheres: 35
    sort_by: druggability_score
    models_to_use: 2                     # Number of models on which to do cavity analysis at most (will be < 'models_to_extract') 

step4_filter_cavities:
  tool: fpocket_filter
  paths:
    input_pockets_zip: dependency/step3_cavity_analysis/output_pockets_zip
    input_summary: dependency/step3_cavity_analysis/output_summary
    output_filter_pockets_zip: filtered_pockets.zip
  properties:
    score: [0, 1]
    druggability_score: [0.5, 1]
    volume: [0, 2000]
