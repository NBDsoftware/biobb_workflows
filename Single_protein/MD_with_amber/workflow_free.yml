working_dir_path: output
can_write_console_log: False
run_md: True
restart: False
remove_tmp: True

step00_reduce_remove_hydrogens:
  tool: reduce_remove_hydrogens
  paths:
    input_path: /path/to/input
    output_path: structure.noH.pdb

step0_extract_molecule:
  tool: extract_molecule
  paths:
    input_structure_path: dependency/step00_reduce_remove_hydrogens/output_path
    output_molecule_path: protein.pdb

step000_cat_pdb:
  tool: cat_pdb
  paths:
    input_structure1: dependency/step0_extract_molecule/output_molecule_path
    input_structure2: /project/scratch/p200581/meluxina/ions.pdb
    output_structure_path: protein.ions.pdb

step1_pdb4amber_run:
  tool: pdb4amber_run
  paths:
    input_pdb_path: dependency/step000_cat_pdb/output_structure_path
    output_pdb_path: structure.pdb4amber.pdb

step2_leap_gen_top:
  tool: leap_gen_top
  paths:
    input_pdb_path: dependency/step1_pdb4amber_run/output_pdb_path
    output_pdb_path: structure.leap.pdb
    output_top_path: structure.leap.top
    output_crd_path: structure.leap.crd
  properties:
    forcefield: ["protein.ff14SB","DNA.bsc1","RNA.OL3","water.tip3p"]

step3_sander_mdrun_minH:
  tool: sander_mdrun
  paths:
    input_top_path: dependency/step2_leap_gen_top/output_top_path
    input_crd_path: dependency/step2_leap_gen_top/output_crd_path
    input_ref_path: dependency/step2_leap_gen_top/output_crd_path
    output_traj_path: sander.h_min.x
    output_rst_path: sander.h_min.rst
    output_log_path: sander.h_min.log
  properties:
    simulation_type: min_vacuo
    mdin : 
      maxcyc: 500
      ntwx: 100
      ntpr: 5
      ntr: 1
      restraintmask: "\":*&!@H=\""
      restraint_wt: 50.0

step4_process_minout_minH:
  tool: process_minout
  paths:
    input_log_path: dependency/step3_sander_mdrun_minH/output_log_path
    output_dat_path: sander.h_min.energy.dat
  properties:
    terms : [ENERGY]

step5_sander_mdrun_min:
  tool: sander_mdrun
  paths:
    input_top_path: dependency/step2_leap_gen_top/output_top_path
    input_crd_path: dependency/step3_sander_mdrun_minH/output_rst_path
    input_ref_path: dependency/step3_sander_mdrun_minH/output_rst_path
    output_traj_path: sander.n_min.x
    output_rst_path: sander.n_min.rst
    output_log_path: sander.n_min.log
  properties:
    simulation_type: min_vacuo
    mdin : 
      maxcyc: 500
      ntwx: 100
      ntpr: 5
      ntr: 1
      restraintmask: "\":*&!@H=\""
      restraint_wt: 50.0

step6_process_minout_min:
  tool: process_minout
  paths:
    input_log_path: dependency/step5_sander_mdrun_min/output_log_path
    output_dat_path: sander.n_min.energy.dat
  properties:
    terms : [ENERGY]

step7_amber_to_pdb:
  tool: amber_to_pdb
  paths:
    input_top_path: dependency/step2_leap_gen_top/output_top_path
    input_crd_path: dependency/step3_sander_mdrun_minH/output_rst_path
    output_pdb_path: structure.ambpdb.pdb

step8_leap_solvate:
  tool: leap_solvate
  paths:
    input_pdb_path: dependency/step7_amber_to_pdb/output_pdb_path
    output_pdb_path: structure.solv.pdb
    output_top_path: structure.solv.parmtop
    output_crd_path: structure.solv.crd
  properties:
    forcefield: ["protein.ff14SB","DNA.bsc1","RNA.OL3","water.tip3p"]
    water_type: TIP3PBOX
    distance_to_molecule: 9
    box_type: truncated_octahedron

step9_leap_add_ions:
  tool: leap_add_ions
  paths:
    input_pdb_path: dependency/step8_leap_solvate/output_pdb_path
    output_pdb_path: structure.ions.pdb
    output_top_path: structure.ions.parmtop
    output_crd_path: structure.ions.crd
  properties:
    forcefield: ["protein.ff14SB","DNA.bsc1","RNA.OL3","water.tip3p"]
    neutralise: True
    positive_ions_type: Na+
    negative_ions_type: Cl-
    ionic_concentration: 150
    box_type: truncated_octahedron

step10_sander_mdrun_energy:
  tool: sander_mdrun
  paths:
    input_top_path: dependency/step9_leap_add_ions/output_top_path
    input_crd_path: dependency/step9_leap_add_ions/output_crd_path
    input_ref_path: dependency/step9_leap_add_ions/output_crd_path
    output_traj_path: sander.min.x
    output_rst_path: sander.min.rst
    output_log_path: sander.min.log
  properties:
    simulation_type: minimization
    mdin : 
      maxcyc: 500
      ntwx: 100
      ntr: 1
      restraintmask: "\"!:WAT,Cl-,Na+\""
      restraint_wt: 50.0

step11_process_minout_energy:
  tool: process_minout
  paths:
    input_log_path: dependency/step10_sander_mdrun_energy/output_log_path
    output_dat_path: sander.min.energy.dat
  properties:
    terms : [ENERGY]

step12_pmemd_mdrun_warm:
  tool: pmemd_mdrun
  paths:
    input_top_path: dependency/step9_leap_add_ions/output_top_path
    input_crd_path: dependency/step10_sander_mdrun_energy/output_rst_path
    input_ref_path: dependency/step10_sander_mdrun_energy/output_rst_path
    output_traj_path: pmemd.heat.netcdf
    output_rst_path: pmemd.heat.rst
    output_log_path: pmemd.heat.log
  properties:
    binary_path: "/project/scratch/p200581/software/amber20/bin/pmemd.cuda"
    simulation_type: heat
    mdin : 
      nstlim: 5000
      dt: 0.002
      ntwx: 100
      ntr: 1
      ntc: 2
      ntf: 2
      ntt: 3
      restraintmask: "\"!:WAT,Cl-,Na+\""
      restraint_wt: 10.0
  

step13_process_mdout_warm:
  tool: process_mdout
  paths:
    input_log_path: dependency/step12_pmemd_mdrun_warm/output_log_path
    output_dat_path: sander.md.temp.dat
  properties:
    terms : [TEMP]

step14_pmemd_mdrun_nvt:
  tool: pmemd_mdrun
  paths:
    input_top_path: dependency/step9_leap_add_ions/output_top_path
    input_crd_path: dependency/step12_pmemd_mdrun_warm/output_rst_path
    input_ref_path: dependency/step12_pmemd_mdrun_warm/output_rst_path
    output_traj_path: pmemd.nvt.netcdf
    output_rst_path: pmemd.nvt.rst
    output_log_path: pmemd.nvt.log
  properties:
    binary_path: "/project/scratch/p200581/software/amber20/bin/pmemd.cuda"
    simulation_type: nvt
    mdin : 
      nstlim: 500000
      ntwx: 5000
      ntr: 1
      restraintmask: "\"!:WAT,Cl-,Na+ & !@H=\""
      restraint_wt: 5.0
  

step15_process_mdout_nvt:
  tool: process_mdout
  paths:
    input_log_path: dependency/step14_pmemd_mdrun_nvt/output_log_path
    output_dat_path: pmemd.md.nvt.temp.dat
  properties:
    terms : [TEMP]

step16_pmemd_mdrun_npt:
  tool: pmemd_mdrun
  paths:
    input_top_path: dependency/step9_leap_add_ions/output_top_path
    input_crd_path: dependency/step14_pmemd_mdrun_nvt/output_rst_path
    input_ref_path: dependency/step14_pmemd_mdrun_nvt/output_rst_path
    output_traj_path: pmemd.npt.netcdf
    output_rst_path: pmemd.npt.rst
    output_log_path: pmemd.npt.log
  properties:
    binary_path: "/project/scratch/p200581/software/amber20/bin/pmemd.cuda"
    simulation_type: npt
    mdin : 
      nstlim: 500000
      ntwx: 5000
      ntr: 1
      restraintmask: "\"!:WAT,Cl-,Na+ & !@H=\""
      restraint_wt: 2.5
    

step17_process_mdout_npt:
  tool: process_mdout
  paths:
    input_log_path: dependency/step16_pmemd_mdrun_npt/output_log_path
    output_dat_path: pmemd.md.npt.dat
  properties:
    terms : [PRES, DENSITY]

#First free mdrun, 200 ns
step18_pmemd_free_mdrun:
  tool: pmemd_mdrun
  paths:
    input_top_path: dependency/step9_leap_add_ions/output_top_path
    input_crd_path: dependency/step16_pmemd_mdrun_npt/output_rst_path
    output_traj_path: pmemd.free.netcdf
    output_rst_path: pmemd.free.rst
    output_log_path: pmemd.free.log
  properties:
    binary_path: "/project/scratch/p200581/software/amber20/bin/pmemd.cuda"
    simulation_type: md
    mdin :
      imin: 0
      irest: 1 
      ntx: 5
      ntb: 2
      ntt: 3
      ntc: 2
      ntf: 2
      ntp: 1
      ig: -1
      ioutfm: 1
      iwrap: 1
      pres0: 1
      taup: 2.0
      cut: 10.0
      tempi: 300.0
      temp0: 300.0
      gamma_ln: 5.0
      dt: 0.002
      nstlim: 100000000
      ntpr: 5000
      ntwr: 5000
      ntwx: 5000
      ntwf: 5000
      ntwv: 5000
    

