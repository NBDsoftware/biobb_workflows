working_dir_path: output                              # Workflow output directory
can_write_console_log: False                           # Output log to console
restart: True                                         # Do not execute steps if output files are already created
remove_tmp: True

# Section 1: Cavity analysis with fpocket on centroids + filtering 

step1_cavity_analysis:
  tool: fpocket_run
  paths:
    output_pockets_zip: all_pockets.zip   
    output_summary: summary.json
  properties:
    min_radius: 3
    max_radius: 6
    num_spheres: 35
    sort_by: druggability_score                

step2_filter_cavities:
  tool: fpocket_filter
  paths:
    input_pockets_zip: dependency/step1_cavity_analysis/output_pockets_zip
    input_summary: dependency/step1_cavity_analysis/output_summary
    output_filter_pockets_zip: filtered_pockets.zip
  properties:
    score: [0.1, 1]
    druggability_score: [0.1, 1]
    volume: [150, 2000]

step3A_renumber_structure:
  tool: renumber_structure
  paths:
    output_structure_path: renumbered.pdb
    output_mapping_json_path: mapping.json
  properties:
    renumber_residues: True
    renumber_residues_per_chain: True

step3B_extract_model:
  tool: extract_model
  paths:
    input_structure_path: dependency/step3A_renumber_structure/output_structure_path
    output_structure_path: extracted.pdb
  properties:
    models: [0]

step3C_extract_residues:
  tool:
  paths:
    input_structure_path: dependency/step3B_extract_model/output_structure_path
    output_residues_path: pocket_residues.pdb

